#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ Kodi –ø–ª–∞–≥–∏–Ω–∞ ArjLover

set -e

PLUGIN_NAME="plugin.video.arjlover"
VERSION="1.0.9"
BUILD_DIR="build"
ZIP_NAME="${PLUGIN_NAME}-${VERSION}.zip"

echo "üî® –°–±–æ—Ä–∫–∞ –ø–ª–∞–≥–∏–Ω–∞ ${PLUGIN_NAME} –≤–µ—Ä—Å–∏–∏ ${VERSION}"

# –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å–±–æ—Ä–∫—É
if [ -d "$BUILD_DIR" ]; then
    echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–±–æ—Ä–∫–∏..."
    rm -rf "$BUILD_DIR"
fi

# –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–±–æ—Ä–∫–∏
echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–±–æ—Ä–∫–∏..."
mkdir -p "$BUILD_DIR/$PLUGIN_NAME"

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã
echo "üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–ª–∞–≥–∏–Ω–∞..."
cp addon.xml "$BUILD_DIR/$PLUGIN_NAME/"
cp main.py "$BUILD_DIR/$PLUGIN_NAME/"
cp -r resources "$BUILD_DIR/$PLUGIN_NAME/"

# –£–¥–∞–ª–∏—Ç—å __pycache__ –µ—Å–ª–∏ –µ—Å—Ç—å
find "$BUILD_DIR/$PLUGIN_NAME" -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true

# –°–æ–∑–¥–∞—Ç—å ZIP –∞—Ä—Ö–∏–≤
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ ZIP –∞—Ä—Ö–∏–≤–∞..."
cd "$BUILD_DIR"
zip -r "$ZIP_NAME" "$PLUGIN_NAME/"
cd ..

# –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å ZIP –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
mv "$BUILD_DIR/$ZIP_NAME" .

# –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
rm -rf "$BUILD_DIR"

echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: $ZIP_NAME"
echo ""
echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ Kodi"
echo "2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è"
echo "3. –ù–∞–∂–º–∏—Ç–µ '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ ZIP —Ñ–∞–π–ª–∞'"
echo "4. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª $ZIP_NAME"
echo "5. –î–æ–∂–¥–∏—Ç–µ—Å—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ"